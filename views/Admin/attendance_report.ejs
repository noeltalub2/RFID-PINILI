<% layout('./Layout/layout.ejs') -%>

  <div class="content">

    <!-- Dynamic Table with Export Buttons -->
    <div class="block block-rounded">
      <div class="block-header block-header-default">
        <h3 class="block-title">Attendance Table <small>All Time</small></h3>
      </div>
      <div class="block-content block-content-full overflow-x-auto">
        <form action="/admin/report-attendance/export" method="get">
          <div class="row">
            <div class="col-lg-7 col-md-6">
              <div class="mb-4">
                <div class="input-daterange input-group" data-date-format="mm/dd/yyyy" data-week-start="1"
                  data-autoclose="true" data-today-highlight="true">
                  <input type="text" class="form-control" id="example-daterange1" name="from"
                    placeholder="From" data-week-start="1" data-autoclose="true" data-today-highlight="true">
                  <span class="input-group-text fw-semibold">
                    <i class="fa fa-fw fa-arrow-right"></i>
                  </span>
                  <input type="text" class="form-control" id="example-daterange2" name="to" placeholder="To"
                    data-week-start="1" data-autoclose="true" data-today-highlight="true">
                </div>
              </div>
            </div>
            <div class="col-lg-3 col-md-3">
              <button type="submit" class="btn btn-success mb-3 w-100" >
                <i class="fa fa-fw fa-file-excel "></i> Export
              </button>
            </div>
          </div>
        </form>
        

        <div class="table-responsive">
          <!-- DataTables init on table by adding .js-dataTable-buttons class, functionality is initialized in js/pages/be_tables_datatables.min.js which was auto compiled from _js/pages/be_tables_datatables.js -->
          <table class="table table-bordered table-striped table-vcenter js-dataTable-responsive">
            <thead>
              <tr>
                <th class="text-center">#</th>
                <th>Full Name</th>

                <th>Log Date</th>
                <th>Time In</th>
                <th>Time Out</th>
                <th>Total Hours</th>
                <th>Status Time In</th>
                <th>Status Time Out</th>

              </tr>
            </thead>
            <tbody>

              <% recentAttendance.forEach(function(entry, index) { %>
                <tr>
                  <td>
                    <%= index + 1 %>
                  </td>
                  <td class="fw-semibold fs-sm d-flex align-items-center">
                    <img src="/images/profile/<%= entry.profile_url %>" class="img-avatar me-2" alt=""
                      style="width: 40px; height: 40px;">
                    <span>
                      <%= entry.lastname %>, <%= entry.firstname %>
                    </span>
                  </td>
                  <td>
                    <%= new Date(entry.log_date).toLocaleDateString("en-US", { month: "long" , day: "numeric" ,
                      year: "numeric" }) %>
                  </td>
                  <td>
                    <%= entry.time_in %>
                  </td>
                  <td>
                    <%= entry.time_out %>
                  </td>
                  <td>
                    <%= entry.total_hours %>
                  </td>
                  <td class="fs-sm text-center">
                    <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill 
                                  <% if (entry.status_timein === 'absent') { %> bg-danger-light text-danger 
                                  <% } else if (entry.status_timein === 'early') { %> bg-warning-light text-warning 
                                  <% } else if (entry.status_timein === 'late') { %> bg-info-light text-info 
                                  <% } else { %> bg-success-light text-success <% } %>">
                      <%= entry.status_timein %>
                    </span>
                  </td>
                  <td class="fs-sm text-center">
                    <% if (entry.status_timeout) {%>
                      <span class="fs-xs fw-semibold d-inline-block py-1 px-3 rounded-pill 
                              <% if (entry.status_timeout === 'absent') { %> bg-danger-light text-danger 
                              <% } else if (entry.status_timeout === 'early') { %> bg-warning-light text-warning 
                              <% } else if (entry.status_timeout === 'late') { %> bg-info-light text-info 
                              <% } else { %> bg-success-light text-success <% } %>">
                        <%= entry.status_timeout %>
                      </span>
                      <%} else {%>

                        <%}%>
                  </td>

                </tr>
                <% }); %>


            </tbody>
          </table>

        </div>

      </div>
    </div>

  </div>
  
  <script>
       document.addEventListener('DOMContentLoaded', function() {
            // Get today's date in MM/DD/YYYY format
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-US');
            
            // Set default values for date inputs
            document.getElementById('example-daterange1').value = formattedDate;
            document.getElementById('example-daterange2').value = formattedDate;
        });
  </script>